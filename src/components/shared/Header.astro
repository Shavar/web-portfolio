---
// Header component - responsive with burger menu using Tailwind CSS
import type { NavigationLink, SocialLink } from '@/types';
import Logo from '@/components/shared/Logo.astro';
import styles from '@/data/styles.json';
interface Props {
  links: NavigationLink[];
  socials: SocialLink[];
}

const { links, socials } = Astro.props;
const currentPath = Astro.url.pathname;
---

<header id="main-header" class="group fixed left-0 right-0 top-4 z-50 transition-all duration-300">
  <div
    class={`${styles.container} flex m-auto items-center justify-between rounded-full py-2 transition-all duration-300 group-[.scrolled]:max-w-4xl group-[.scrolled]:bg-navigation-bg group-[.scrolled]:backdrop-blur-xl group-[.scrolled]:shadow-md`}
  >
    <!-- Logo/Brand -->
    <a href="/" class="flex w-[100px] items-center gap-2">
      <div
        class="flex h-8 w-8 items-center justify-center rounded-full text-gray-900 dark:text-white"
      >
        <Logo />
      </div>
    </a>

    <!-- Desktop Navigation -->
    <nav class="hidden items-center gap-2 rounded-full p-1 md:flex">
      {
        links.map((link: NavigationLink) => {
          const isActive = currentPath === link.href;

          return (
            <a
              href={link.href}
              class={`rounded-full px-4 py-1.5 text-sm font-medium text-gray-700 transition-colors hover:bg-white dark:hover:bg-gray-700 dark:text-gray-300${isActive ? ' bg-primary-bg' : ' bg-transparent'}`}
              target={link.target}
            >
              {link.label}
            </a>
          );
        })
      }
    </nav>

    <!-- Action Buttons -->
    <div class="flex w-[100px] items-center justify-end gap-2">
      <!-- Desktop Action Icons -->
      <div class="hidden gap-4 pr-2 pt-1 sm:flex">
        {
          socials.map((social: SocialLink) => {
            return (
              <a
                aria-label={social.label}
                class="transition-colors"
                href={social.href}
                target={social.target}
              >
                <i class={social.faIcon + ' text-xl'} />
              </a>
            );
          })
        }
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-btn"
        class="text-dark-800 flex h-9 w-9 items-center justify-center rounded-full bg-gray-100 md:hidden dark:bg-gray-800 dark:text-white"
        aria-label="Toggle navigation"
        aria-expanded="false"
      >
        <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
          <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Navigation Menu -->
  <nav id="mobile-nav" class="mt-4 hidden md:hidden">
    <div
      class="rounded-2xl border border-black/5 bg-white/80 p-4 shadow-xl backdrop-blur-xl dark:bg-gray-900/80"
    >
      <div class="space-y-2">
        <a
          href="/#profile"
          class="block rounded-xl px-4 py-3 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800"
          >About</a
        >
        <a
          href="/#experience"
          class="block rounded-xl px-4 py-3 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800"
          >Experience</a
        >
        <a
          href="/#projects"
          class="block rounded-xl px-4 py-3 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800"
          >Projects</a
        >
        <a
          href="/#websites"
          class="block rounded-xl px-4 py-3 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800"
          >Websites</a
        >
      </div>
    </div>
  </nav>
</header>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileNav = document.getElementById('mobile-nav');
    const header = document.getElementById('main-header');

    // Mobile menu functionality (keep existing code)
    mobileMenuBtn?.addEventListener('click', () => {
      const isExpanded = mobileMenuBtn.getAttribute('aria-expanded') === 'true';
      const newState = !isExpanded;

      mobileMenuBtn.setAttribute('aria-expanded', newState.toString());

      if (newState) {
        mobileNav?.classList.remove('hidden');
      } else {
        mobileNav?.classList.add('hidden');
      }
    });

    // Close menu when clicking nav links
    mobileNav?.addEventListener('click', (e) => {
      if (e.target instanceof HTMLAnchorElement) {
        mobileNav.classList.add('hidden');
        mobileMenuBtn?.setAttribute('aria-expanded', 'false');
      }
    });

    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        mobileNav?.classList.add('hidden');
        mobileMenuBtn?.setAttribute('aria-expanded', 'false');
      }
    });

    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!mobileMenuBtn?.contains(e.target as Node) && !mobileNav?.contains(e.target as Node)) {
        mobileNav?.classList.add('hidden');
        mobileMenuBtn?.setAttribute('aria-expanded', 'false');
      }
    });

    // Scroll-based approach for intro section
    const introSection =
      document.querySelector('section#intro') || document.querySelector('section#hero');

    const heightOffset = introSection?.id == 'hero' ? 500 : 200;

    if (introSection && header) {
      let ticking = false;

      const checkScroll = () => {
        const rect = introSection.getBoundingClientRect();
        const remainingHeight = rect.bottom;

        // If 100px or less of the intro section is visible
        if (remainingHeight <= heightOffset) {
          header.classList.add('scrolled');
        } else {
          header.classList.remove('scrolled');
        }

        ticking = false;
      };

      const onScroll = () => {
        if (!ticking) {
          requestAnimationFrame(checkScroll);
          ticking = true;
        }
      };

      window.addEventListener('scroll', onScroll, { passive: true });

      // Initial check
      checkScroll();
    }
  });
</script>
