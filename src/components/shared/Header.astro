---
// Header component - responsive with burger menu using Tailwind CSS
import type { NavigationLink, SocialLink } from '@/types';
import Logo from '@/components/shared/Logo.astro';
import styles from '@/data/styles.json';
interface Props {
  links: NavigationLink[];
  socials: SocialLink[];
}

const { links, socials } = Astro.props;
const currentPath = Astro.url.pathname;
---

<header id="main-header" class="group fixed left-0 right-0 top-4 z-50 transition-all duration-300">
  <div
    class={`${styles.container} hidden md:flex m-auto items-center justify-between rounded-full py-2 transition-all duration-300 group-[.scrolled]:max-w-4xl group-[.scrolled]:bg-navigation-bg group-[.scrolled]:backdrop-blur-xl group-[.scrolled]:shadow-md`}
  >
    <!-- Logo/Brand -->
    <a href="/" class="flex w-[100px] items-center gap-2">
      <div
        class="flex h-8 w-8 items-center justify-center rounded-full text-gray-900 dark:text-white"
      >
        <Logo />
      </div>
    </a>

    <!-- Desktop Navigation -->
    <nav class="hidden items-center gap-2 rounded-full p-1 md:flex">
      {
        links.map((link: NavigationLink) => {
          const isActive = currentPath === link.href;

          return (
            <a
              href={link.href}
              class={`rounded-full px-4 py-1.5 text-sm font-medium text-gray-700 transition-colors hover:bg-white dark:hover:bg-gray-700 dark:text-gray-300${isActive ? ' bg-primary-bg' : ' bg-transparent'}`}
              target={link.target}
            >
              {link.label}
            </a>
          );
        })
      }
    </nav>

    <!-- Action Buttons -->
    <div class="flex w-[100px] items-center justify-end gap-2">
      <!-- Desktop Action Icons -->
      <div class="hidden gap-4 pr-2 pt-1 sm:flex">
        {
          socials.map((social: SocialLink) => {
            return (
              <a
                aria-label={social.label}
                class="transition-colors"
                href={social.href}
                target={social.target}
              >
                <i class={social.faIcon + ' text-xl'} />
              </a>
            );
          })
        }
      </div>
    </div>
  </div>

  <!-- Mobile Menu Button -->
  <button
    id="mobile-menu-btn"
    class="group fixed right-6 top-6 z-50 md:hidden"
    aria-label="Toggle navigation"
    aria-expanded="false"
  >
    <div
      class="relative flex h-[50px] w-[50px] transform items-center justify-center overflow-hidden rounded-full bg-slate-700 shadow-md ring-0 ring-gray-300 ring-opacity-30 transition-all duration-200 hover:ring-8 group-focus:ring-4"
    >
      <div
        class="flex h-[20px] w-[20px] origin-center transform flex-col justify-between overflow-hidden transition-all duration-300"
      >
        <div
          class="h-[2px] w-7 origin-left transform bg-white transition-all duration-300 group-focus:translate-x-10"
        >
        </div>
        <div
          class="h-[2px] w-7 transform rounded bg-white transition-all delay-75 duration-300 group-focus:translate-x-10"
        >
        </div>
        <div
          class="h-[2px] w-7 origin-left transform bg-white transition-all delay-150 duration-300 group-focus:translate-x-10"
        >
        </div>

        <div
          class="absolute top-2.5 flex w-0 -translate-x-10 transform items-center justify-between transition-all duration-500 group-focus:w-12 group-focus:translate-x-0"
        >
          <div
            class="absolute h-[2px] w-5 rotate-0 transform bg-white transition-all delay-300 duration-500 group-focus:rotate-45"
          >
          </div>
          <div
            class="absolute h-[2px] w-5 -rotate-0 transform bg-white transition-all delay-300 duration-500 group-focus:-rotate-45"
          >
          </div>
        </div>
      </div>
    </div>
  </button>

  <!-- Mobile Navigation Menu -->
  <nav id="mobile-nav" class="fixed left-0 top-0 hidden md:hidden">
    <div
      class="h-screen w-screen scale-95 transform rounded-2xl border border-black/5 bg-white/80 p-4 opacity-0 shadow-xl backdrop-blur-xl transition-all duration-300 ease-out dark:bg-gray-900/80"
    >
      <div class="space-y-2">
        <a
          href="/#profile"
          class="block translate-x-4 transform rounded-xl px-4 py-3 text-sm font-medium text-gray-700 opacity-0 transition-all duration-200 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800"
          style="transition-delay: 100ms;">About</a
        >
        <a
          href="/#experience"
          class="block translate-x-4 transform rounded-xl px-4 py-3 text-sm font-medium text-gray-700 opacity-0 transition-all duration-200 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800"
          style="transition-delay: 150ms;">Experience</a
        >
        <a
          href="/#projects"
          class="block translate-x-4 transform rounded-xl px-4 py-3 text-sm font-medium text-gray-700 opacity-0 transition-all duration-200 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800"
          style="transition-delay: 200ms;">Projects</a
        >
        <a
          href="/#websites"
          class="block translate-x-4 transform rounded-xl px-4 py-3 text-sm font-medium text-gray-700 opacity-0 transition-all duration-200 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800"
          style="transition-delay: 250ms;">Websites</a
        >
      </div>
    </div>
  </nav>
</header>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileNav = document.getElementById('mobile-nav');
    const header = document.getElementById('main-header');

    // Mobile menu functionality with animations
    mobileMenuBtn?.addEventListener('click', () => {
      const isExpanded = mobileMenuBtn.getAttribute('aria-expanded') === 'true';
      const newState = !isExpanded;

      mobileMenuBtn.setAttribute('aria-expanded', newState.toString());

      if (newState) {
        // Show menu with animation
        mobileNav?.classList.remove('hidden');

        // Trigger animations after a brief delay to ensure visibility
        requestAnimationFrame(() => {
          const menuContainer = mobileNav?.querySelector('div');
          const menuLinks = mobileNav?.querySelectorAll('a');

          // Animate menu container
          menuContainer?.classList.remove('opacity-0', 'scale-95');
          menuContainer?.classList.add('opacity-100', 'scale-100');

          // Animate menu links with staggered effect
          menuLinks?.forEach((link) => {
            link.classList.remove('translate-x-4', 'opacity-0');
            link.classList.add('translate-x-0', 'opacity-100');
          });
        });
      } else {
        // Hide menu with animation
        const menuContainer = mobileNav?.querySelector('div');
        const menuLinks = mobileNav?.querySelectorAll('a');

        // Animate out menu container and links
        menuContainer?.classList.remove('opacity-100', 'scale-100');
        menuContainer?.classList.add('opacity-0', 'scale-95');

        menuLinks?.forEach((link) => {
          link.classList.remove('translate-x-0', 'opacity-100');
          link.classList.add('translate-x-4', 'opacity-0');
        });

        // Hide after animation completes
        setTimeout(() => {
          mobileNav?.classList.add('hidden');
        }, 300);
      }
    });

    // Helper function to close menu with animation
    const closeMenuWithAnimation = () => {
      const menuContainer = mobileNav?.querySelector('div');
      const menuLinks = mobileNav?.querySelectorAll('a');

      menuContainer?.classList.remove('opacity-100', 'scale-100');
      menuContainer?.classList.add('opacity-0', 'scale-95');

      menuLinks?.forEach((link) => {
        link.classList.remove('translate-x-0', 'opacity-100');
        link.classList.add('translate-x-4', 'opacity-0');
      });

      setTimeout(() => {
        mobileNav?.classList.add('hidden');
        mobileMenuBtn?.setAttribute('aria-expanded', 'false');
      }, 300);
    };

    // Close menu when clicking nav links
    mobileNav?.addEventListener('click', (e) => {
      if (e.target instanceof HTMLAnchorElement) {
        closeMenuWithAnimation();
      }
    });

    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !mobileNav?.classList.contains('hidden')) {
        closeMenuWithAnimation();
      }
    });

    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
      if (
        !mobileMenuBtn?.contains(e.target as Node) &&
        !mobileNav?.contains(e.target as Node) &&
        !mobileNav?.classList.contains('hidden')
      ) {
        closeMenuWithAnimation();
      }
    });

    // Scroll-based approach for intro section
    const introSection =
      document.querySelector('section#intro') || document.querySelector('section#hero');

    const heightOffset = introSection?.id == 'hero' ? 500 : 200;

    if (introSection && header) {
      let ticking = false;

      const checkScroll = () => {
        const rect = introSection.getBoundingClientRect();
        const remainingHeight = rect.bottom;

        // If 100px or less of the intro section is visible
        if (remainingHeight <= heightOffset) {
          header.classList.add('scrolled');
        } else {
          header.classList.remove('scrolled');
        }

        ticking = false;
      };

      const onScroll = () => {
        if (!ticking) {
          requestAnimationFrame(checkScroll);
          ticking = true;
        }
      };

      window.addEventListener('scroll', onScroll, { passive: true });

      // Initial check
      checkScroll();
    }
  });
</script>
