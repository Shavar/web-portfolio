---
// Header component - responsive with burger menu using Tailwind CSS
import type { NavigationLink, SocialLink } from '@/types';
import Logo from '@/components/shared/Logo.astro';
import styles from '@/data/styles.json';
interface Props {
  links: NavigationLink[];
  socials: SocialLink[];
}

const { links, socials } = Astro.props;
const currentPath = Astro.url.pathname;
---

<header id="main-header" class="group fixed top-4 left-0 right-0 z-50 transition-all duration-300">
  <div
    class={`${styles.container} flex m-auto items-center justify-between rounded-full py-2 transition-all duration-300 group-[.scrolled]:max-w-4xl group-[.scrolled]:bg-navigation-bg group-[.scrolled]:backdrop-blur-xl group-[.scrolled]:shadow-md`}
  >
    <!-- Logo/Brand -->
    <a href="/" class="flex items-center gap-2 w-[100px]">
      <div
        class="w-8 h-8 text-gray-900 dark:text-white rounded-full flex items-center justify-center"
      >
        <Logo />
      </div>
    </a>

    <!-- Desktop Navigation -->
    <nav class="hidden md:flex items-center gap-2 p-1 rounded-full">
      {
        links.map((link: NavigationLink) => {
          const isActive = currentPath === link.href;

          return (
            <a
              href={link.href}
              class={`text-sm font-medium px-4 py-1.5 rounded-full transition-colors hover:bg-white dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300${isActive ? ' bg-primary-bg' : ' bg-transparent'}`}
              target={link.target}
            >
              {link.label}
            </a>
          );
        })
      }
    </nav>

    <!-- Action Buttons -->
    <div class="flex justify-end items-center gap-2 w-[100px]">
      <!-- Desktop Action Icons -->
      <div class="hidden sm:flex gap-4 pt-1 pr-2">
        {
          socials.map((social: SocialLink) => {
            return (
              <a
                aria-label={social.label}
                class="transition-colors"
                href={social.href}
                target={social.target}
              >
                <i class={social.faIcon + ' text-xl'} />
              </a>
            );
          })
        }
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-btn"
        class="flex h-9 w-9 items-center justify-center rounded-full bg-gray-100 text-dark-800 md:hidden dark:bg-gray-800 dark:text-white"
        aria-label="Toggle navigation"
        aria-expanded="false"
      >
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
          <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Navigation Menu -->
  <nav id="mobile-nav" class="hidden mt-4 md:hidden">
    <div
      class="bg-white/80 backdrop-blur-xl rounded-2xl p-4 shadow-xl border border-black/5 dark:bg-gray-900/80"
    >
      <div class="space-y-2">
        <a
          href="/#profile"
          class="block px-4 py-3 text-sm font-medium text-gray-700 rounded-xl hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800 transition-colors"
          >About</a
        >
        <a
          href="/#experience"
          class="block px-4 py-3 text-sm font-medium text-gray-700 rounded-xl hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800 transition-colors"
          >Experience</a
        >
        <a
          href="/#projects"
          class="block px-4 py-3 text-sm font-medium text-gray-700 rounded-xl hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800 transition-colors"
          >Projects</a
        >
        <a
          href="/#websites"
          class="block px-4 py-3 text-sm font-medium text-gray-700 rounded-xl hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800 transition-colors"
          >Websites</a
        >
      </div>
    </div>
  </nav>
</header>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileNav = document.getElementById('mobile-nav');
    const header = document.getElementById('main-header');

    // Mobile menu functionality (keep existing code)
    mobileMenuBtn?.addEventListener('click', () => {
      const isExpanded = mobileMenuBtn.getAttribute('aria-expanded') === 'true';
      const newState = !isExpanded;

      mobileMenuBtn.setAttribute('aria-expanded', newState.toString());

      if (newState) {
        mobileNav?.classList.remove('hidden');
      } else {
        mobileNav?.classList.add('hidden');
      }
    });

    // Close menu when clicking nav links
    mobileNav?.addEventListener('click', (e) => {
      if (e.target instanceof HTMLAnchorElement) {
        mobileNav.classList.add('hidden');
        mobileMenuBtn?.setAttribute('aria-expanded', 'false');
      }
    });

    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        mobileNav?.classList.add('hidden');
        mobileMenuBtn?.setAttribute('aria-expanded', 'false');
      }
    });

    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!mobileMenuBtn?.contains(e.target as Node) && !mobileNav?.contains(e.target as Node)) {
        mobileNav?.classList.add('hidden');
        mobileMenuBtn?.setAttribute('aria-expanded', 'false');
      }
    });

    // Scroll-based approach for intro section
    const introSection =
      document.querySelector('section#intro') || document.querySelector('section#hero');

    const heightOffset = introSection?.id == 'hero' ? 500 : 200;

    if (introSection && header) {
      let ticking = false;

      const checkScroll = () => {
        const rect = introSection.getBoundingClientRect();
        const remainingHeight = rect.bottom;

        // If 100px or less of the intro section is visible
        if (remainingHeight <= heightOffset) {
          header.classList.add('scrolled');
        } else {
          header.classList.remove('scrolled');
        }

        ticking = false;
      };

      const onScroll = () => {
        if (!ticking) {
          requestAnimationFrame(checkScroll);
          ticking = true;
        }
      };

      window.addEventListener('scroll', onScroll, { passive: true });

      // Initial check
      checkScroll();
    }
  });
</script>
