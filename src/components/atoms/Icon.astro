---
interface Props {
  name: string;
  class?: string;
  width?: string;
  height?: string;
  wrap?: boolean;
  preserveColors?: boolean;
}

const {
  name,
  class: className = '',
  width = '24',
  height = '24',
  wrap = false,
  preserveColors = false,
} = Astro.props;

// Normalize the icon name to match the file name in /public/icons
const normalizedName = name.toLowerCase().replace(/\s+/g, '');

// Map common name variations to actual file names
const iconMap: Record<string, string> = {
  css: 'CSS3 Logo',
  css3: 'CSS3 Logo',
  html: 'html5',
  next: 'nextjs',
  node: 'nodejs',
  linkedin: 'linkedin',
  github: 'github',
};

// Get the actual file name
const fileName = iconMap[normalizedName] || normalizedName;
const iconPath = `/icons/${fileName}.svg`;

// Read and inline the SVG content for styling support
let svgContent = '';
try {
  const fs = await import('node:fs');
  const path = await import('node:path');
  const filePath = path.join(process.cwd(), 'public', 'icons', `${fileName}.svg`);
  svgContent = fs.readFileSync(filePath, 'utf-8');

  // Replace hardcoded fill colors with currentColor to support CSS text color inheritance
  // unless preserveColors is true (for brand logos, etc.)
  if (!preserveColors) {
    svgContent = svgContent.replace(/fill="[^"]*"/g, 'fill="currentColor"');
  }

  svgContent = svgContent
    .replace(/width="[^"]*"/g, `width="${width}"`)
    .replace(/height="[^"]*"/g, `height="${height}"`)
    .replace(/<svg/, `<svg class="${className}"`);
} catch (error) {
  console.error(`Failed to load icon: ${fileName}.svg`, error);
}
---

{
  wrap ? (
    <div class="mx-auto flex h-12 w-12 justify-center" set:html={svgContent} />
  ) : (
    <Fragment set:html={svgContent} />
  )
}
